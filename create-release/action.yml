name: Create a GitHub Release

inputs:
  token:
    description: GitHub token for creating GitHub Releases.
    required: true

env:
  CARGO_INCREMENTAL: 0
  CARGO_NET_GIT_FETCH_WITH_CLI: true
  CARGO_NET_RETRY: 10
  CARGO_TERM_COLOR: always
  RUST_BACKTRACE: 1
  RUSTFLAGS: -D warnings
  RUSTUP_MAX_RETRIES: 10
  TEST_ENV_FOO: foobar

runs:
  using: "composite"
  steps:
    - run: echo $RUSTFLAGS
      shell: bash --noprofile --norc -CeEuxo pipefail {0}
    - run: echo $TEST_ENV_FOO
      shell: bash --noprofile --norc -CeEuxo pipefail {0}
    - uses: taiki-e/checkout-action@v1
    - name: Install Rust
      run: rustup update stable --no-self-update
      shell: bash --noprofile --norc -CeEuxo pipefail {0}
    - run: cargo package
      shell: bash --noprofile --norc -CeEuxo pipefail {0}
    - uses: taiki-e/create-gh-release-action@v1
      with:
        changelog: CHANGELOG.md
        title: Release $version
        branch: main
        token: ${{ inputs.token }}
